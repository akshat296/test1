<html>
<head>
 <style>
    body {
      font-family: 'Arial', sans-serif;
    }

    .header input[type=text] {
      width: 500px;
      max-width: 100%;
    }

    #js-canvas{
      width: 1500;
      height : 600
    }
    .canvas {
      width: 800;
      height : 500;
    }
  </style>
</head>
<body>

  <div class="canvas">
    <div id="js-canvas"></div>
    <div id="js-properties-panel" style='width:500;height:500'>
    </div>
  </div>



  <!-- viewer -->
  <script src="https://unpkg.com/bpmn-js@2.1.0/dist/bpmn-viewer.development.js"></script>

  <!-- jquery (required for example only) -->
  <script src="https://unpkg.com/jquery@3.3.1/dist/jquery.js"></script>

  <!-- app -->

  <script>
    var viewer = new BpmnJS({
      container: $('#js-canvas'),
      height: 600,
      width:1500
    });



    function openFromUrl(url, history) {
     console.log(JSON.stringify(history));
      var url_string = window.location.href;
    var history_url = new URL(url_string);
  var c = history_url.searchParams.get("c");
  var ab = JSON.parse(c);

      $.ajax(url, { dataType : 'text' }).done(function(xml) {

        viewer.importXML(xml, function(err) {



          if (err) {

            console.error(err);
          } else {
// logging history

var myObj, i, j, x = "<ul style='border: 1px solid #CCC ; box-shadow: 0 0 2px 1px #f8f8f8; list-style-type: none;'><br>";

//myObj =ab;
myObj = history;

myObj1={"process":{"state":{"tokens":[{"position":"Review","owningProcessId":null}]},"history":{"historyEntries":[{"name":"Alka","type":"StartEvent_1","begin":1530016981577,"end":1530016981578,"roles":["R_EMP","R-PRJ-TLead"],"user":"Alka","role":["R_EMP","R-PRJ-TLead"]}


,{"name":"Alka","type":"Task_1fibyn8","begin":1530016981578,"end":1530016996784,"roles":["R_EMP","R-PRJ-TLead"],"user":"Alka","role":["R_EMP","R-PRJ-TLead"]}

,{"name":"Alka","type":"ExclusiveGateway_1l6zq8d","begin":1530016996784,"end":1530016996785,"roles":["R_EMP","R-PRJ-TLead"],"user":"Alka","role":["R_EMP","R-PRJ-TLead"]}

,{"name":"Alka","type":"Task_03fvjdg","begin":1530016996785,"end":null,"roles":["R_EMP","R-PRJ-TLead"],"user":"Alka","role":["R_EMP","R-PRJ-TLead"]},

{"name":"Alka","type":"ExclusiveGateway_1fph9hs","begin":1530016996785,"end":null,"roles":["R_EMP","R-PRJ-TLead"],"user":"Alka","role":["R_EMP","R-PRJ-TLead"]}
]}}};
for (i in myObj.process.history.historyEntries) {
    x += "<div class=history-list  style='border: 1px solid #CCC'><div style='margin: 0 0 6px 11px;'><h3><a id="+  myObj1.process.history.historyEntries[i].type +" href='' > "+myObj.process.history.historyEntries[i].type+"</a></h3>";
     x+= "<li> User: " + myObj.process.history.historyEntries[i].user + "</li>";
    x+="<li> Role: " + myObj.process.history.historyEntries[i].role + "</li>";
     x += "<li> Name: " + myObj.process.history.historyEntries[i].name + "</li>";
    x += "<li> Type: " + myObj.process.history.historyEntries[i].type + "</li>";
    x += "<li>Begin:" + myObj.process.history.historyEntries[i].begin + "</li>";
    x += "<li> End:" + myObj.process.history.historyEntries[i].end + "</li></div></div><br>";

}
x+="</ul>";
console.log(x);
// console.log(document.getElementById("js-properties-panel"));
document.getElementById("js-properties-panel").innerHTML = x;

// document.getElementById('js')




// implementing the history interaction

var eventBus = viewer.get('eventBus');

// you may hook into any of the following events
var events = [
  'element.click',
];

events.forEach(function(event) {

  eventBus.on(event, function(e) {
    console.log(e.element.id);
    var h = document.getElementById(e.element.id);
    // alert('clicked me');
    h.focus();
  });
});
            viewer.get('canvas').zoom('fit-viewport');
          }
        });
      });
    }


      var url = 'http://10.101.10.95:3000/leaves/getProcessXml/leave';
     // openFromUrl(url);
     window.openFromUrl= openFromUrl;

    ///// auto open ?url=diagram-url ///////////////////////

    (function() {
      var str = window.location.search;
      var match = /(?:\&|\?)url=([^&]+)/.exec(str);

      if (match) {
        var url = decodeURIComponent(match[1]);
        $('#js-url').val(url);
        openFromUrl(url);
      }
    })();
  </script>
</html>
